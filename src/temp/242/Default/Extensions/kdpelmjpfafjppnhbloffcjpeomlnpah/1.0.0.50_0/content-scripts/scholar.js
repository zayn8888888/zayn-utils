!function(){const e=window.chrome&&window.chrome.runtime,t=window.chrome&&window.chrome.storage.local;if(!e)return;if(window._wpsPdfScholarInjected)return;window._wpsPdfScholarInjected=!0;const n=e.getURL("icons/pdf16.png"),o=[{text:"Quick guide",mode:"chat_quick_guide",className:"wps-pdf-button"},{text:"Chat PDF",mode:"chat_chat",className:"wps-pdf-button chat-pdf"},{text:"Translate",mode:"translate",className:"wps-pdf-button translate"}],a=[{text:"Open with WPS PDF",mode:"default"},{text:"Hide until next use",mode:"close_tab"},{text:"Disable Globally",mode:"close_local"}],s="scholar_pdf_buttons_disabled",c="scholar_pdf_buttons_disabled_expiry",d=10;function i(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout((()=>{clearTimeout(n),e(...o)}),t)}}function r(e,t,n,o={}){const a={...o};e.addEventListener(t,n,a)}function l(){document.querySelectorAll(".wps-buttons-container").forEach((e=>{e.style.display="none"}))}function p(){document.querySelectorAll(".wps-buttons-container").forEach((e=>{e.style.display="block"}))}function u(o){const i=document.createElement("div");i.className="icon-dropdown";const p=document.createElement("img");p.src=n,p.alt="WPS PDF",p.style.margin="0",i.appendChild(p),r(p,"click",(function(t){t.preventDefault(),t.stopPropagation(),e.sendMessage({action:"openPdf",url:o,mode:"default"})}));const u=document.createElement("div");return u.className="icon-dropdown-content",a.forEach((n=>{const a=document.createElement("a");a.className="icon-dropdown-item",a.textContent=n.text,a.href="#",r(a,"click",(function(a){a.preventDefault(),a.stopPropagation(),"close_tab"===n.mode?l():"close_local"===n.mode?function(){const e=new Date;e.setDate(e.getDate()+d),t.set({[s]:!0,[c]:e.getTime()}),l()}():e.sendMessage({action:"openPdf",url:o,mode:n.mode}),e.sendMessage({action:"recordEvent",eventName:"oversea_pdf_plugin_click",data:{button_name:`scholar_dropdown_${n.mode}`}})})),u.appendChild(a)})),i.appendChild(u),i}const f=i((function(){document.querySelectorAll(".gs_or_ggsm").forEach((t=>{t.dataset.wpsPdfProcessed||(t.dataset.wpsPdfProcessed="true",t.querySelectorAll("a").forEach((t=>{if(function(e){const t=(e.href||"").toLowerCase(),n=(e.textContent||"").toLowerCase(),o=e.querySelector("img")?.alt?.toLowerCase()||"",a=[/\[pdf\]/i,/pdf\s*version/i,/pdf\s*file/i,/download\s*pdf/i,/view\s*pdf/i,/full\s*text/i];if([/\.pdf$/i,/\/pdf\//i,/[?&]pdf=/i,/type=pdf/i,/format=pdf/i,/application\/pdf/i,/download=pdf/i].some((e=>e.test(t))))return!0;if(a.some((e=>e.test(n)||e.test(o))))return!0;const s=e.parentElement?.textContent?.toLowerCase()||"";return!!a.some((e=>e.test(s)))}(t)&&!t.parentNode.querySelector(".wps-buttons-container")){const n=document.createElement("div");n.className="wps-buttons-container";const a=document.createElement("a");a.textContent="[PDF]",a.className="wps-pdf-text",n.appendChild(a),r(a,"click",(function(n){n.preventDefault(),n.stopPropagation(),e.sendMessage({action:"openPdf",url:t.href,mode:"default"})})),o.forEach((o=>{const a=function(t,n){const o=document.createElement("a");o.className=n.className,o.href=t,o.target="_blank",o.title=`使用${n.text}打开PDF文件`;const a=document.createElement("span");return a.textContent=n.text,o.appendChild(a),r(o,"click",(function(o){o.preventDefault(),e.sendMessage({action:"openPdf",url:t,mode:n.mode}),e.sendMessage({action:"recordEvent",eventName:"oversea_pdf_plugin_click",data:{button_name:`scholar_button_${n.mode}`}})})),o}(t.href,o);n.appendChild(a)}));const s=u(t.href);n.appendChild(s),t.parentNode.insertBefore(n,t.nextSibling)}})))})),t.get([s,c],(e=>{if(e&&!0===e[s])if(e[c]){const n=e[c];(new Date).getTime()<n?l():(t.set({[s]:!1,[c]:null}),p())}else t.set({[s]:!1}),p();else p()}))}),250);r(window,"load",(()=>{new MutationObserver(i((e=>{let t=!1;e.forEach((e=>{"childList"===e.type&&e.addedNodes.length>0&&(t=!0)})),t&&f()}),250)).observe(document.body,{childList:!0,subtree:!0}),e.sendMessage({action:"recordEvent",eventName:"oversea_pdf_plugin_page",data:{action:"show",item:"scholar_inject"}})})),f()}();