import{r as e,o as t,g as o,h as n,k as l,i,l as s,p as a,t as r,x as c,w as d,n as u,e as m,s as _,y as v,q as p,F as x,m as f,b as h,a as w,c as g,z as y,A as b,B as k,u as E,v as L}from"./runtime-dom.esm-bundler-65457635.js";import{g as M,a as V,s as C,d as S,b as U,c as $,r as T,e as j,f as q,h as B,j as I,k as A,l as N,u as O,n as R,o as D,p as P,q as F,i as z}from"./util-2d803e2a.js";import{v as W,x as J}from"./index-7b1b919b.js";import{o as G,a as H,s as K,g as X,d as Y}from"./tool-aa30449a.js";import{_ as Q,J as Z,s as ee,i as te}from"./chrome-runtime-promise-fcd5d99a.js";import{i as oe,g as ne,a as le,b as ie,c as se,I as ae,d as re,G as ce}from"./stat-b988e0dc.js";const de=["id"],ue=["onClick"],me=Q({__name:"content-mac",setup(r){const c="xl_chrome_ext_"+J,d=e(W),u=e(!1),m=e(!1),_=e(""),v=e(""),p=e([]),x=e(!1),f=e([]),h=e(!1),w=e(!1),g=()=>{_.value&&chrome.runtime.sendMessage({name:G.xl_download,linkUrl:v.value,refererUrl:document.location.href,cookie:document.cookie})};t(()=>{document.addEventListener("scroll",L),document.body.addEventListener("mousemove",U),window.self!==window.top&&document.body.addEventListener("mouseout",E),document.addEventListener("scroll",L),T()});const y=()=>{const e=document.getElementById(c);e&&(e.style.display="none")},b=()=>{const e=document.getElementById(c);e&&(e.remove(),document.body.removeEventListener("mousemove",U,!0),window.self!==window.top&&document.body.removeEventListener("mouseout",E),document.body.removeEventListener("scroll",L),_.value=null,v.value=void 0,p.value=[])},k=e=>{const t=document.getElementById(c);if(!t)return;t.style.display="block",m.value=!0;const o=e.getBoundingClientRect(),n=`position:fixed;left: ${o.x+4}px; top: ${o.y+4}px; height: 30px; z-index: 10000000000 !important`;t.style=n,h.value||(h.value=!0,chrome.runtime.sendMessage({name:G.xl_video_show,referurl:document.location.href,videoSrc:e.src}))},E=e=>{if(_.value){document.getElementById(W).contains(e.toElement)||(_.value=null,v.value=void 0,y())}},L=()=>{_.value&&k(_.value)},U=e=>{const t=document.elementFromPoint(e.x,e.y);if(!t)return;if("video"===t.tagName.toLocaleLowerCase()){const e=t.src||M(t);if(!e||0===e.toLocaleLowerCase().indexOf("blob:"))return;if(t===_.value)return;return _.value=t,v.value=e,void k(t)}if(_.value){if(!V(e,_.value))return _.value=null,v.value=void 0,void y()}else{let t=null;for(const o of p.value)if("none"!==window.getComputedStyle(o).display)if(V(e,o))if(t){(Number(window.getComputedStyle(o).zIndex)||0)>(Number(window.getComputedStyle(t).zIndex)||0)&&(t=o)}else t=o;else if(t){const e=t.src||M(t);e&&0!==e.toLowerCase().indexOf("blob:")&&(_.value=t,v.value=e,k(t))}if(t){const e=t.src||M(t);e&&0!==e.toLowerCase().indexOf("blob:")&&(_.value=t,v.value=e,k(t))}}},$=async()=>{chrome.runtime.sendMessage({name:G.xl_call_function,method:H.getWebsiteDomains},async e=>{f.value=new Set(await e.websiteDomains);const t=S.exec(document.location.host)[2];w.value=f.value.has(t),x.value&&!w.value&&(u.value=!0)})},T=async()=>{await(async()=>{const e=await chrome.runtime.sendMessage({name:G.CheckEnabled});e&&(x.value=e.isInstallThunder)})(),await $();const e=document.getElementsByTagName("video");p.value=e,!p.value.length>0||C(p.value)};return(e,t)=>(o(),n("div",{class:l([e.$style["content-wrapper"],e.$style["mac-content-wrapper"]]),id:d.value},[m.value?(o(),n("div",{key:0,class:l(e.$style["video-wrapper"])},[i("div",{class:l([e.$style["options-wrapper"]])},[i("div",{class:l(e.$style["xl-chrome-ext-bar__logo"])},null,2),i("div",{class:l([e.$style["xl-chrome-ext-tips"],e.$style.download]),onClick:s(g,["stop"])},[i("a",{id:"xl_chrome_ext_bar_download",class:l([e.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),i("div",{class:l([e.$style["xl-chrome-ext-title"]])},"下载视频",2)],10,ue),i("a",{id:"xl_chrome_ext_close",class:l([e.$style["xl-chrome-ext-bar__option"]]),title:"本次关闭",href:"javascript:;",onClick:b},[i("div",{class:l(["xl-close img",[e.$style["xl-close"],e.$style.img]])},null,2)],2)],2)],2)):a("",!0)],10,de))}},[["__cssModules",{$style:{video_op_wrapper:"_video_op_wrapper_1aqct_1",video_op_list:"_video_op_list_1aqct_1",op_icon:"_op_icon_1aqct_1",op_text:"_op_text_1aqct_1",op_item:"_op_item_1aqct_1",download:"_download_1aqct_1",play:"_play_1aqct_1",screen:"_screen_1aqct_1","options-wrapper":"_options-wrapper_1aqct_20","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_1aqct_14","xl-chrome-ext-bar__logo":"_xl-chrome-ext-bar__logo_1aqct_1","xl-chrome-ext-bar-toast__success":"_xl-chrome-ext-bar-toast__success_1aqct_1","xl-chrome-ext-bar-toast__error":"_xl-chrome-ext-bar-toast__error_1aqct_1","xl-chrome-ext-bar-toast__text":"_xl-chrome-ext-bar-toast__text_1aqct_1","xl-chrome-ext-tips":"_xl-chrome-ext-tips_1aqct_1","xl-chrome-ext-title":"_xl-chrome-ext-title_1aqct_1","xl-chrome-ext-title--footer":"_xl-chrome-ext-title--footer_1aqct_1","xl-chrome-ext-bar__option":"_xl-chrome-ext-bar__option_1aqct_1",img:"_img_1aqct_1","xl-download":"_xl-download_1aqct_1","xl-screen":"_xl-screen_1aqct_1","xl-close":"_xl-close_1aqct_1","content-wrapper":"_content-wrapper_1aqct_3","video-wrapper":"_video-wrapper_1aqct_8","mac-content-wrapper":"_mac-content-wrapper_1aqct_11"}}]]);function _e(e){!function(e){chrome.runtime.sendMessage(e)}({name:"xl_prompt_click",...e})}const ve=["id"],pe={class:"xl-chrome-ext-dialog__title"},xe=c('<ul class="xl-chrome-ext-dialog__content"><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-download"></div><div class="xl-chrome-ext-dialog__content-text">一键读取网页中的可下载链接</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-video"></div><div class="xl-chrome-ext-dialog__content-text">网页视频下载、存云盘、投屏播放</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-picture"></div><div class="xl-chrome-ext-dialog__content-text">批量下载图片</div></li></ul>',1),fe={class:"xl-chrome-ext-dialog__footer"},he={__name:"ActionErrorDialog",props:{text:{type:String,required:!0}},emits:["submit","cancel"],setup(l){const a=e(U("action"));return t(async()=>{}),(e,t)=>(o(),n("div",{class:"xl-chrome-ext-dialog",id:a.value},[i("h2",pe,"无法"+r(l.text)+"，请安装迅雷客户端后重试",1),i("a",{action:"close",href:"javascript:;",class:"xl-chrome-ext-dialog__close",title:"关闭",onClick:t[0]||(t[0]=s(t=>e.$emit("cancel","close"),["stop"]))}),xe,i("div",fe,[i("button",{onClick:t[1]||(t[1]=s(t=>e.$emit("submit","install"),["stop"])),action:"install",class:"xl-chrome-ext-dialog__button xl-download"}," 迅雷高速下载 "),i("button",{onClick:t[2]||(t[2]=t=>e.$emit("cancel","once-close")),action:"once-close",class:"xl-chrome-ext-dialog__button xl-close"}," 取消 ")])],8,ve))}},we={animate__bounceOutUp:"_animate__bounceOutUp_ti0wz_29",bounceInUp:"_bounceInUp_ti0wz_1","xl-chrome-ext-footer__ball":"_xl-chrome-ext-footer__ball_ti0wz_33","xl-chrome-ext-footer__name":"_xl-chrome-ext-footer__name_ti0wz_50"},ge={id:"xl-chrome-ext-footer",class:"xl-chrome-ext-footer"},ye=["onClick","onMouseenter","onMouseleave","onAnimationend"],be=i("div",{class:"xl-chrome-ext-footer__logo"},null,-1),ke={class:"xl-chrome-ext-footer__quantity"},Ee=["onMouseenter","onMouseleave","onAnimationend"],Le={key:0,class:"xl-chrome-ext-footer__jsq"},Me={class:"xl-chrome-ext-footer__content"},Ve={class:"xl-chrome-ext-footer__text"},Ce={class:"xl-chrome-ext-footer__action"},Se=["onClick","onMouseenter","onMouseleave"],Ue=i("h3",null,"用迅雷享高速下载",-1),$e=i("div",{class:"xl-chrome-ext-footer__explain"},"当前页面含资源如下：",-1),Te={class:"xl-chrome-ext-footer__list"},je=["data","onClick"],qe=i("div",{class:"xl-chrome-ext-footer__action-name"},"下载",-1),Be=["onClick","onMouseenter","onMouseleave"],Ie={class:"xl-chrome-ext-footer__action-name"},Ae={class:"xl-chrome-ext-footer__button-text"},Ne=i("h3",null,"存迅雷云盘，享高清播放、高速下载",-1),Oe=i("div",{class:"xl-chrome-ext-footer__explain"},"当前页面含资源如下：",-1),Re={class:"xl-chrome-ext-footer__list"},De=["onClick"],Pe={class:"xl-chrome-ext-footer__button-text"},Fe={key:0,class:"xl-chrome-ext-footer__agreement"},ze=i("span",null,"启用插件访问在线视频时，插件将在播放窗口展示对播放链接的快捷功能",-1),We=["onClick"],Je={class:"xl-chrome-ext-footer__close-wrapper"},Ge={class:"xl-chrome-ext-tips"},He=["onClick"],Ke=i("div",{class:"xl-chrome-ext-title xl-chrome-ext-title--footer"},"本次关闭",-1),Xe=Q({__name:"Footer",props:{resourceList:{type:Object,required:!0},exception:{type:Boolean,required:!0},isShowJsqEntry:{type:Boolean,required:!0},jsqText:{type:Object,required:!0}},emits:["removeFooter","showActionError","showVersionError","handleDownload","handleCloseBar"],setup(c,{emit:h}){const w=h,g=c,y=e(null),b=e(!1),k=e(null),E=e(null),L=e(!1),M=e(!1),V=e(!1),C=e(0),S=e(0),U=e(null),$=e(null),T=e(!1),j=e(!0),q=e(g.resourceList.playList.length===g.resourceList.length),B=e(0===g.resourceList.saveList.length);function I(){b.value=!0,y.value=setTimeout(()=>{b.value=!1},5e3)}function A(){T.value=!0,g.resourceList.downloadList.length>0&&u(()=>{if(U.value){const{height:e}=window.getComputedStyle(U.value);C.value=`-${parseFloat(e)+16}px`}}),g.resourceList.saveList.length>0&&u(()=>{if($.value){const{height:e}=window.getComputedStyle($.value);S.value=`-${parseFloat(e)+16}px`}})}function N(e){return e.isInIframe&&".m3u8"===e.suffix&&(e.fileName=X(e.suffix,e.url)),e.fileName}function O(){E.value=setTimeout(()=>{M.value=!1},300)}function R(){E.value&&clearTimeout(E.value),M.value=!0}function D(){z(g.resourceList.saveList[0])}function P(){k.value=setTimeout(()=>{V.value=!1},300)}function F(){k.value&&clearTimeout(k.value),V.value=!0}async function z(e){const t=e;if(g.exception)return w("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:!1,data:t});if(t.isVideoURL){L.value=!0;const{isAccept:e}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(L.value=!1,!e)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:!1,data:t})}var o;(o=t).suffix&&chrome.runtime.sendMessage({name:"xl_cloudadd",from:"bottom_bar",data:{opt:"web:cloudadd",params:{url:o.url,name:o.fileName,ext:o.suffix,isVideo:o.isVideoURL,cookie:document.cookie,webTitle:document.title}},isM3U8Video:".m3u8"===o.suffix},e=>{e&&("version"===e.errType&&w("showVersionError",e.text),chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"bottom_bar",isSuccess:e.result,data:o}))})}function W(){if(g.exception){w("showActionError","下载","download");const e=g.resourceList.downloadList[0];chrome.runtime.sendMessage({name:"xl_download_stat",link:e.url,stat:e.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",status:"fail"})}else{J(g.resourceList.downloadList[0])}}function J(e){chrome.runtime.sendMessage({name:"xl_download",link:e.url,cookie:document.cookie,referurl:document.location.href,stat:e.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",isM3U8Video:".m3u8"===e.suffix},e=>{e&&"version"===e.errType&&w("showVersionError",e.text)})}d(b,e=>{!0===e&&A()});const G=e(!0);function H(){chrome.runtime.sendMessage({name:"xl_footer_other_click",clickId:"close"}),w("removeFooter")}function Y(){chrome.storage.local.set({isAgreementVisible:!1}),j.value=!1}function Q(){const e=G.value?"fix_bar":"release_bar";G.value=!G.value,b.value=!G.value,chrome.runtime.sendMessage({name:"xl_footer_other_click",clickId:e})}function ee(){y.value&&clearTimeout(y.value),b.value||(b.value=!0)}function te(){G.value&&(b.value=!1)}function oe(){G.value&&(E.value=setTimeout(()=>{b.value=!1},800))}function ne(){y.value&&clearTimeout(y.value),E.value&&clearTimeout(E.value),G.value&&(b.value=!0)}function le(){const e=document.querySelector("#xl-chrome-ext-footer");if(!e.nextSibling)return;e.parentElement.appendChild(e)}return chrome.storage.local.get("isAgreementVisible",e=>{e&&!1===e.isAgreementVisible?j.value=!1:j.value=!0}),t(()=>{chrome.runtime.sendMessage({name:"xl_footer_show",url:document.location.href,downloadShow:0!==g.resourceList.downloadList.length?1:0,playShow:!B.value&&q.value?1:0,saveShow:B.value||q.value?0:1,resourceList:JSON.stringify(g.resourceList)}),K(le,3e5,!0)}),(e,t)=>(o(),n("div",ge,[i("div",{class:l(["",[e.$style.animate__bounceOutUp,e.$style["xl-chrome-ext-footer__ball"]]]),onClick:s(Q,["stop"]),onMouseenter:s(ee,["stop"]),onMouseleave:s(te,["stop"]),onAnimationend:s(I,["stop"])},[be,i("div",ke,r(c.resourceList.length),1)],42,ye),i("div",{onMouseenter:s(ne,["stop"]),onMouseleave:s(oe,["stop"]),onAnimationend:s(A,["stop"]),class:l({"xl-chrome-ext-footer__bar":!0,"xl-chrome-ext-footer__bar--show":b.value})},[c.isShowJsqEntry?(o(),n("div",Le,[m(Z,{source:"footer",text:c.jsqText},null,8,["text"])])):a("",!0),i("div",Me,[i("p",Ve," 检测到页面存在 "+r(c.resourceList.length<=99?c.resourceList.length:99)+" 个资源 ",1),i("div",Ce,[_(i("div",{class:"xl-chrome-ext-footer__url download",onClick:s(W,["stop"]),onMouseenter:s(R,["stop"]),onMouseleave:s(O,["stop"])},[c.resourceList.downloadList.length>0?(o(),n("div",{key:0,ref_key:"downloadPopoverRef",ref:U,style:p({top:C.value}),class:l({"xl-chrome-ext-footer__popover":!0,"xl-chrome-ext-footer__popover--show":M.value,"xl-chrome-ext-footer__popover--hidden":!M.value})},[Ue,$e,i("ul",Te,[(o(!0),n(x,null,f(c.resourceList.downloadList,(t,a)=>(o(),n("li",{class:"xl-chrome-ext-footer__item",key:a},[i("div",{class:l({"xl-chrome-ext-footer__type":!0,"xl-video":t.isVideoURL,"xl-link":!t.isVideoURL})},null,2),i("div",{class:l(e.$style["xl-chrome-ext-footer__name"])},r(N(t)),3),i("button",{type:"download",data:JSON.stringify(t),onClick:s(e=>{return o=t,void(g.exception?(w("showActionError","下载","download"),chrome.runtime.sendMessage({name:"xl_download_stat",link:o.url,stat:o.isVideoURL?"chrome_download_video":"chrome_download_other",from:"bottom_bar",status:"fail"})):J(o));var o},["stop"])}," 下载 ",8,je)]))),128))])],6)):a("",!0),qe],40,Se),[[v,c.resourceList.downloadList.length>0]]),c.resourceList.saveList.length>0?(o(),n("div",{key:0,class:"xl-chrome-ext-footer__url cloudAdd",onClick:s(D,["stop"]),onMouseenter:s(F,["stop"]),onMouseleave:s(P,["stop"])},[i("div",Ie,[i("div",{class:l({"xl-chrome-ext-footer__button-icon":!0,loading:L.value,save:!q.value,play:!!q.value})},null,2),i("span",Ae,r(L.value?"添加中":q.value?"流畅播":"存云盘"),1)]),c.resourceList.saveList.length>0?(o(),n("div",{key:0,ref_key:"cloudAddPopoverRef",ref:$,style:p({top:S.value}),class:l({"xl-chrome-ext-footer__popover":!0,"xl-chrome-ext-footer__popover--show":V.value,"xl-chrome-ext-footer__popover--hidden":!V.value})},[Ne,Oe,i("ul",Re,[(o(!0),n(x,null,f(c.resourceList.saveList,(t,a)=>(o(),n("li",{class:"xl-chrome-ext-footer__item",key:a},[i("div",{class:l({"xl-chrome-ext-footer__type":!0,"xl-video":t.isVideoURL,"xl-link":!t.isVideoURL})},null,2),i("div",{class:l(e.$style["xl-chrome-ext-footer__name"])},r(N(t)),3),i("button",{onClick:s(e=>function(e,t){z(t)}(0,t),["stop"])},[i("div",{class:l({"xl-chrome-ext-footer__button-icon":!0,small:!0,loading:L.value,save:!t.isVideoURL,play:!!t.isVideoURL})},null,2),i("span",Pe,r(t.isVideoURL?"流畅播":"存云盘"),1)],8,De)]))),128))])],6)):a("",!0)],40,Be)):a("",!0)]),j.value?(o(),n("div",Fe,[ze,i("span",{class:"xl-chrome-ext-footer__know",onClick:s(Y,["stop"])},"我知道了",8,We)])):a("",!0),i("div",Je,[i("div",Ge,[i("div",{class:"xl-chrome-ext-footer__close",onClick:s(H,["stop"])},null,8,He),Ke])])])],42,Ee)]))}},[["__cssModules",{$style:we}]]),Ye=["id"],Qe=i("h2",{class:"xl-chrome-ext-dialog__title"},"浏览器无法直接打开磁力链等特殊格式链接",-1),Ze=c('<ul class="xl-chrome-ext-dialog__content"><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-download"></div><div class="xl-chrome-ext-dialog__content-text">高速下载：基础加速、超级通道、会员加速三重加速</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-compatible"></div><div class="xl-chrome-ext-dialog__content-text">强大兼容：支持磁力、种子、在线视频</div></li><li class="xl-chrome-ext-dialog__content-li"><div class="xl-chrome-ext-dialog__content-icon xl-pan"></div><div class="xl-chrome-ext-dialog__content-text">超大云盘：最高12TB备份</div></li></ul>',1),et={class:"xl-chrome-ext-dialog__footer"},tt={__name:"ResourceDialog",emits:["submit","cancel"],setup(l){const a=e(U("resource"));return t(async()=>{}),(e,t)=>(o(),n("div",{class:"xl-chrome-ext-dialog",id:a.value},[Qe,i("a",{action:"close",href:"javascript:;",class:"xl-chrome-ext-dialog__close",title:"关闭",onClick:t[0]||(t[0]=s(t=>e.$emit("cancel","close"),["stop"]))}),Ze,i("div",et,[i("button",{action:"install",class:"xl-chrome-ext-dialog__button xl-download",onClick:t[1]||(t[1]=s(t=>e.$emit("submit","install"),["stop"]))}," 迅雷高速下载 "),i("button",{action:"close",class:"xl-chrome-ext-dialog__button xl-close",onClick:t[2]||(t[2]=s(t=>e.$emit("cancel","close"),["stop"]))}," 取消 ")])],8,Ye))}};const ot=new class{constructor(){this.options={enabled:!0,colors:{info:"#0000FF",warn:"#FFA500",error:"#FF0000",log:"#000000"}}}setEnabled(e){this.options.enabled=e}setColors(e){this.options.colors={...this.options.colors,...e}}logMessage(e,t,...o){if(!this.options.enabled)return;this.options.colors[e]}info(e,...t){this.logMessage("info",e,...t)}warn(e,...t){this.logMessage("warn",e,...t)}error(e,...t){this.logMessage("error",e,...t)}log(e,...t){this.logMessage("log",e,...t)}},nt=["onMouseenter","onMouseleave","onClick"],lt=Q({__name:"link-badge-win",emits:["showVersionError"],setup(a,{emit:r}){const c=r;e([]);const d="badge_wrapper_"+J,u=e(null),m=e(null),_=e("");e(null);const v=e(!1);e({top:0,left:0}),e(1e3);const p=T;function x(){ot.info("badge tag click",m.value);const e={link:_.value,stat:"chrome_download_other"};ot.info("badge tag click",e),async function({link:e=""}){const t={link:e,stat:"chrome_download_other",isM3U8Video:!1};try{const e=await async function({fileName:e="",link:t="",stat:o=""}){return await chrome.runtime.sendMessage({name:"xl_download",link:t,fileName:e,cookie:document.cookie,referurl:document.location.href,stat:o,from:v.value?"text_hover":"link_hover",isInIframe:$(),isM3U8Video:!1})}(t);ot.info("badge dl resp",e)}catch(o){"version"===(null==o?void 0:o.errType)&&(ot.info("badge dl error",null==o?void 0:o.text),c("showVersionError",null==o?void 0:o.text))}}(e)}const f=()=>{ot.log("enter badge浮层")},w=()=>{g()};function g(){try{u.value.style.display="none"}catch(e){ot.warn("hideLinkPopover",e)}}const y=e=>{const t=e.target,o=t.href||"",n=function(e){let t="";return e.childNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE&&(t+=e.textContent.trim())}),t}(t),l=p.test(o),i=p.test(n);(l||i)&&(e.preventDefault(),_.value=l?o:n,m.value=t,v.value=!l,function(e,t){const o=u.value;o.style.display="flex";const n=o.getBoundingClientRect(),l=t.getBoundingClientRect(),i=e.clientX-n.width/4,s=l.top-n.height;o.style.left=i+"px",o.style.top=s+"px"}(e,t),chrome.runtime.sendMessage({name:"xl_stat",eventId:977,extParam:{value2:_.value,value7:v.value?"text_hover":"link_hover"}}))};function b(e){var t;(null==(t=null==e?void 0:e.toElement)?void 0:t.id.includes(d))||e.target!==m.value||g()}return t(()=>{ot.info("link-badge onMounted"),document.body.addEventListener("mouseenter",y,!0),document.body.addEventListener("mouseleave",b,!0)}),h(()=>{document.body.removeEventListener("mouseenter",y,!0),clearTimeout(null),ot.info("link-badge onUnmounted")}),(e,t)=>(o(),n("div",{class:l([d,e.$style.badge_wrapper]),id:d,ref_key:"linkPopRef",ref:u,onMouseenter:s(f,["stop"]),onMouseleave:s(w,["stop"]),onClick:s(x,["stop"])},[i("div",{class:l(e.$style.logo)},null,2),i("span",{class:l(e.$style.line)},null,2),i("div",{class:l(e.$style.text_wrapper)},[i("span",{class:l(e.$style.download_icon)},null,2),i("span",{class:l(e.$style.text)},"高速下载",2)],2)],42,nt))}},[["__cssModules",{$style:{badge_wrapper:"_badge_wrapper_eor63_1",logo:"_logo_eor63_20",line:"_line_eor63_27",text_wrapper:"_text_wrapper_eor63_33",download_icon:"_download_icon_eor63_39",text:"_text_eor63_33"}}]]),it={class:"dialog-wrapper xly-dialog-prompt"},st=[i("i",{class:"xl-icon-close"},null,-1)],at={class:"xly-dialog-prompt__text"},rt=i("p",{class:"xly-dialog-prompt__text"},"（升级提示：主菜单-检查更新）",-1),ct={class:"xly-dialog-prompt__footer"},dt={class:"xly-dialog-prompt__button"},ut={__name:"VersionError",props:{text:{type:String,required:!0}},emits:["submit","cancel"],setup:(e,{emit:l})=>(t(async()=>{}),(t,l)=>(o(),n("div",it,[i("h2",null,r(e.text)+"调用失败",1),i("a",{action:"close",href:"javascript:;",onClick:l[0]||(l[0]=s(e=>t.$emit("cancel","close"),["stop"])),class:"xly-dialog-close",title:"关闭"},st),i("p",at,"客户端版本过低，无法启用"+r(e.text)+"。",1),rt,i("div",ct,[i("div",dt,[i("button",{action:"close",class:"td-button--other",style:{width:"65px","border-radius":"4px"},onClick:l[1]||(l[1]=e=>t.$emit("cancel","close"))}," 取消 "),i("button",{action:"startThunder",class:"td-button",onClick:l[2]||(l[2]=s(e=>t.$emit("submit","startThunder"),["stop"]))},"前往升级")])])])))},mt={video_op_wrapper:"_video_op_wrapper_pujw6_1",video_op_list:"_video_op_list_pujw6_1",op_icon:"_op_icon_pujw6_1",op_text:"_op_text_pujw6_1",op_item:"_op_item_pujw6_1",download:"_download_pujw6_1",play:"_play_pujw6_1",screen:"_screen_pujw6_1","options-wrapper":"_options-wrapper_pujw6_3","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_pujw6_15","xl-chrome-ext-bar__logo":"_xl-chrome-ext-bar__logo_pujw6_30","xl-chrome-ext-bar-toast__success":"_xl-chrome-ext-bar-toast__success_pujw6_38","xl-chrome-ext-bar-toast__error":"_xl-chrome-ext-bar-toast__error_pujw6_46","xl-chrome-ext-bar-toast__text":"_xl-chrome-ext-bar-toast__text_pujw6_54","xl-chrome-ext-tips":"_xl-chrome-ext-tips_pujw6_62","xl-chrome-ext-title":"_xl-chrome-ext-title_pujw6_69","xl-chrome-ext-title--footer":"_xl-chrome-ext-title--footer_pujw6_74","xl-chrome-ext-bar__option":"_xl-chrome-ext-bar__option_pujw6_78",img:"_img_pujw6_94","xl-download":"_xl-download_pujw6_101","xl-screen":"_xl-screen_pujw6_105","xl-close":"_xl-close_pujw6_109"},_t=["onClick"],vt=["onClick"],pt=["onClick"],xt=["onClick"],ft=Q({__name:"VideoTagV1",props:{latestVideoSrc:{type:String,required:!0},latestVideoElement:{type:String,required:!0},exception:{type:Boolean,required:!0},isShowVideoTag:{type:Boolean,required:!0},isShowDownloadBar:{type:Boolean,required:!0},isShowCloudAddBar:{type:Boolean,required:!0}},emits:["showActionError","showVersionError","handleDownload","handleCloseBar"],setup(c,{emit:d}){const u=d,m=c,p=e(!1),f=e(""),h=e("success"),g=e(null),y=w({isM3U8Video:!1,M3U8VideoUrl:""});function b(){if(m.exception)return u("showActionError","下载","download"),void chrome.runtime.sendMessage({name:"xl_download_stat",link:y.M3U8VideoUrl||m.latestVideoSrc,stat:"chrome_download_video",from:"video_hover",status:"fail",videoUIVersion:"v1"});!function(){do{if(!m.latestVideoElement)break;const e=m.latestVideoElement;if(!m.latestVideoSrc)break;let t="",o="";if(document.title){const n=document.title.replace(/[*?/:|<>"]/g,"");n&&(o=j(q(m.latestVideoSrc)),o||(o=L(e)),t=`${n}${o}`)}chrome.runtime.sendMessage({name:"xl_download",link:y.M3U8VideoUrl||m.latestVideoSrc,cookie:document.cookie,referurl:document.location.href,fileName:t,stat:"chrome_download_video",from:"video_hover",isInIframe:$(),isM3U8Video:!!y.M3U8VideoUrl,videoUIVersion:"v1"})}while(0)}()}async function k(){const e=B(y.M3U8VideoUrl||m.latestVideoSrc),t={from:"video_hover",data:{opt:"web:cloudadd",params:{url:e.url,name:e.fileName,ext:e.suffix,isVideo:e.isVideoURL}}};if($()?t.name="xl_cloudadd_in_iframe":(t.name="xl_cloudadd",t.cookie=document.cookie,t.webTitle=document.title),m.exception)return u("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});const{isAccept:o}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(!o)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播。",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});chrome.runtime.sendMessage(t,e=>{e&&"version"===e.errType&&u("showVersionError",e.text)})}function E(){if(m.exception)return void u("showActionError","投屏","projection");const e={url:m.latestVideoSrc,name:document.title,playForm:document.referrer,dlnaPlay:!0,stat:"browser_plugin_tv_sp_click"};chrome.runtime.sendMessage({name:"xl_screen",type:"click",data:{opt:"web:play",params:e}},e=>{e&&"version"===e.errType&&u("showVersionError","投屏")})}function L(e){let t=void 0;for(let o=0;o<e.children.length;o++){const n=e.children[o];if("source"===n.tagName.toLowerCase()&&n.type){const e=n.type.split("/");e.length>0&&(t=e[e.length-1]);break}}return t?"."+t:""}function M(){navigator.clipboard?chrome.runtime.sendMessage({name:"xl_copy",text:y.M3U8VideoUrl||m.latestVideoSrc},e=>{e.status&&V({isShow:!0,msg:"复制成功",type:"success"})}):V({isShow:!0,msg:"复制失败",type:"error"})}function V(e){const{isShow:t,msg:o,type:n}=e;p.value=t,f.value=o,h.value=n,g.value&&clearTimeout(g.value),g.value=setTimeout(()=>{p.value=!1},1500)}return t(async()=>{chrome.runtime.sendMessage({name:"xl_screen",type:"init",data:{params:{playForm:document.referrer}}},e=>{y.isM3U8Video=(null==e?void 0:e.isM3U8Video)||!1,y.M3U8VideoUrl=(null==e?void 0:e.M3U8VideoUrl)||""})}),(e,t)=>(o(),n(x,null,[p.value?(o(),n("div",{key:0,class:l([e.$style["xl-chrome-ext-bar-toast"]])},[i("div",{class:l(["success"===h.value?e.$style["xl-chrome-ext-bar-toast__success"]:"","error"===h.value?e.$style["xl-chrome-ext-bar-toast__error"]:""])},null,2),i("div",{class:l([e.$style["xl-chrome-ext-bar-toast__text"]])},r(f.value),3)],2)):a("",!0),_(i("div",{class:l([e.$style["options-wrapper"]])},[i("a",{onClick:t[0]||(t[0]=s(t=>e.$emit("handleCloseBar"),["stop"])),id:"xl_chrome_ext_bar_close",href:"javascript:;"}),i("div",{class:l(e.$style["xl-chrome-ext-bar__logo"])},null,2),c.isShowCloudAddBar?(o(),n("div",{key:0,class:l([e.$style["xl-chrome-ext-tips"],e.$style["cloud-add"]]),onClick:s(k,["stop"])},[i("a",{id:"xl_chrome_ext_bar_cloudAdd",class:l(e.$style["xl-chrome-ext-bar__option"]),href:"javascript:;"},null,2),i("div",{class:l(e.$style["xl-chrome-ext-title"])},"流畅播",2)],10,_t)):a("",!0),c.isShowDownloadBar?(o(),n("div",{key:1,class:l([e.$style["xl-chrome-ext-tips"],e.$style.download]),onClick:s(b,["stop"])},[i("a",{id:"xl_chrome_ext_bar_download",class:l([e.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),i("div",{class:l([e.$style["xl-chrome-ext-title"]])},"下载视频",2)],10,vt)):a("",!0),i("div",{onClick:s(E,["stop"]),class:l([e.$style["xl-chrome-ext-tips"]])},[i("a",{id:"xl_chrome_ext_bar_screen",href:"javascript:;",class:l([e.$style["xl-chrome-ext-bar__option"]])},null,2),i("div",{class:l([e.$style["xl-chrome-ext-title"]])},"投屏",2)],10,pt),i("div",{onClick:s(M,["stop"]),class:l([e.$style["xl-chrome-ext-tips"]])},[i("a",{id:"xl_chrome_ext_bar_copy",class:l([e.$style["xl-chrome-ext-bar__option"]]),href:"javascript:;"},null,2),i("div",{class:l([e.$style["xl-chrome-ext-title"]])},"复制链接",2)],10,xt)],2),[[v,c.isShowVideoTag]])],64))}},[["__cssModules",{$style:mt}]]),ht=["onClick"],wt=Q({__name:"VideoTagV2",props:{latestVideoSrc:{type:String,required:!0},latestVideoElement:{type:String,required:!0},exception:{type:Boolean,required:!0},isShowVideoTag:{type:Boolean,required:!0},isShowDownloadBar:{type:Boolean,required:!0},isShowCloudAddBar:{type:Boolean,required:!0}},emits:["showActionError","showVersionError","handleDownload","handleCloseBar"],setup(a,{emit:c}){const d=c,u=a;e(!1),e(""),e("success"),e(null);const m=w({isM3U8Video:!1,M3U8VideoUrl:""}),p=e([{text:"下载",id:"download",icon:"download"},{text:"流畅播",id:"play",icon:"play"},{text:"投屏",id:"screen",icon:"screen"}]),h=g(()=>{let e=[...p.value];return u.isShowCloudAddBar||(e=e.filter(e=>"play"!==e.id)),e});function y(e){switch(e.id){case"download":!function(){if(ot.info("badge tag click"),u.exception)return d("showActionError","下载","download"),void chrome.runtime.sendMessage({name:"xl_download_stat",link:m.M3U8VideoUrl||u.latestVideoSrc,stat:"chrome_download_video",from:"video_hover",status:"fail",videoUIVersion:"v2"});!function(){do{if(!u.latestVideoElement)break;const e=u.latestVideoElement;if(!u.latestVideoSrc)break;let t="",o="";if(document.title){const n=document.title.replace(/[*?/:|<>"]/g,"");n&&(o=j(q(u.latestVideoSrc)),o||(o=k(e)),t=`${n}${o}`)}b({link:m.M3U8VideoUrl||u.latestVideoSrc,fileName:t})}while(0)}()}();break;case"screen":!function(){if(u.exception)return void d("showActionError","投屏","projection");const e={url:u.latestVideoSrc,name:document.title,playForm:document.referrer,dlnaPlay:!0,stat:"browser_plugin_tv_sp_click"};chrome.runtime.sendMessage({name:"xl_screen",type:"click",data:{opt:"web:play",params:e}},e=>{e&&"version"===e.errType&&d("showVersionError","投屏")})}();break;case"play":!async function(){const e=B(m.M3U8VideoUrl||u.latestVideoSrc),t={from:"video_hover",data:{opt:"web:cloudadd",params:{url:e.url,name:e.fileName,ext:e.suffix,isVideo:e.isVideoURL}}};$()?t.name="xl_cloudadd_in_iframe":(t.name="xl_cloudadd",t.cookie=document.cookie,t.webTitle=document.title);if(u.exception)return d("showActionError","流畅播","fluent_play"),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});const{isAccept:o}=await chrome.runtime.sendMessage({name:"xl_check_blacklist"});if(!o)return chrome.runtime.sendMessage({name:"xl_show_toast",text:"链接异常，无法流畅播。",type:"info"}),void chrome.runtime.sendMessage({name:"xl_cloudadd_stat",from:"video_hover",isSuccess:!1,data:e});chrome.runtime.sendMessage(t,e=>{e&&"version"===e.errType&&d("showVersionError",e.text)})}()}}function b({fileName:e="",link:t=""}){chrome.runtime.sendMessage({name:"xl_download",link:t,fileName:e,cookie:document.cookie,referurl:document.location.href,stat:"chrome_download_video",from:"video_hover",isInIframe:$(),isM3U8Video:!!m.M3U8VideoUrl,videoUIVersion:"v2"})}function k(e){let t=void 0;for(let o=0;o<e.children.length;o++){const n=e.children[o];if("source"===n.tagName.toLowerCase()&&n.type){const e=n.type.split("/");e.length>0&&(t=e[e.length-1]);break}}return t?"."+t:""}return t(async()=>{chrome.runtime.sendMessage({name:"xl_screen",type:"init",data:{params:{playForm:document.referrer}}},e=>{m.isM3U8Video=(null==e?void 0:e.isM3U8Video)||!1,m.M3U8VideoUrl=(null==e?void 0:e.M3U8VideoUrl)||""})}),(e,t)=>_((o(),n("div",{class:l([e.$style.video_op_wrapper])},[i("ul",{class:l(e.$style.video_op_list)},[(o(!0),n(x,null,f(h.value,(t,a)=>(o(),n("li",{key:a,class:l([e.$style.op_item,e.$style[t.id]]),onClick:s(e=>y(t),["stop"])},[i("span",{class:l(e.$style.op_icon)},null,2),i("span",{class:l(e.$style.op_text)},r(t.text),3)],10,ht))),128))],2)],2)),[[v,a.isShowVideoTag]])}},[["__cssModules",{$style:{video_op_wrapper:"_video_op_wrapper_mpbxe_1",video_op_list:"_video_op_list_mpbxe_17",op_icon:"_op_icon_mpbxe_24",op_text:"_op_text_mpbxe_30",op_item:"_op_item_mpbxe_38",download:"_download_mpbxe_44",play:"_play_mpbxe_47",screen:"_screen_mpbxe_50"}}]]),gt=["id"],yt={key:0},bt={key:1},kt=Q({__name:"videoTag",setup(t){const l=e(Y),i=e(W);return async function(){try{const e=await ee({name:"GetConfig"});e&&(l.value=null==e?void 0:e.videoTagVersion)}catch(e){}}(),(e,t)=>(o(),n("div",{id:i.value},["v2"===l.value?(o(),n("div",yt,[m(wt,y(b(e.$attrs)),null,16)])):(o(),n("div",bt,[m(ft,y(b(e.$attrs)),null,16)]))],8,gt))}},[["__cssModules",{$style:mt}]]);function Et(){this.states={},this._current=void 0}Et.prototype.start=function(e){if(void 0!==this._current)throw"State machine already started";if(null==e)throw"Please give a valid state name";setTimeout(Et._changeState,0,this,e)},Et.prototype.fireEvent=function(e,t){if(void 0===this._current)throw"State machine not started";if(null===this._current)throw"State machine terminated";setTimeout(Et._handleEvent,0,this,e,t)},Et._changeState=function(e,t){if(null!==t&&!e.states.hasOwnProperty(t))throw e._current=null,'No such state "'+t+'"';let o=e._current;if(void 0!==o&&o.hasOwnProperty("__exit__")&&o.__exit__.apply(e),null===t)return void(e._current=null);if(o=e._current=e.states[t],!o.hasOwnProperty("__enter__"))return;const n=o.__enter__.apply(e);void 0!==n&&setTimeout(Et._changeState,0,e,n)},Et._handleEvent=function(e,t,o){let n=e._current[t];"function"==typeof n&&(n=n.apply(e,o)),void 0!==n&&setTimeout(Et._changeState,0,e,n)};let Lt={};const Mt={glass:"ncennffkjdiamlpmcbajkmaiiiddgioo-glass",help:"ncennffkjdiamlpmcbajkmaiiiddgioo-help",overlay:"ncennffkjdiamlpmcbajkmaiiiddgioo-overlay"},Vt={closing:"ncennffkjdiamlpmcbajkmaiiiddgioo-closing",exiting:"ncennffkjdiamlpmcbajkmaiiiddgioo-exiting",inverted:"ncennffkjdiamlpmcbajkmaiiiddgioo-inverted",invisible:"ncennffkjdiamlpmcbajkmaiiiddgioo-invisible",loading:"ncennffkjdiamlpmcbajkmaiiiddgioo-loading",relative:"ncennffkjdiamlpmcbajkmaiiiddgioo-relative",selected:"ncennffkjdiamlpmcbajkmaiiiddgioo-selected",selectionRectangle:"ncennffkjdiamlpmcbajkmaiiiddgioo-selection-rectangle"};function Ct(){this._invertedSelection=!1,this._curpos={x:0,y:0},this._selectableElements=[],this._visibleElements=[];const e=this,t=document.createElement("div");t.id=Mt.overlay;const o=document.createElement("div");o.id=Mt.glass;const n=document.createElement("div");n.id=Mt.help,n.innerHTML=chrome.i18n.getMessage("usage"),n.onmouseover=function(){n.classList.add(Vt.invisible)},n.onmouseout=function(){n.classList.remove(Vt.invisible)};const l=function(e){e.preventDefault(),e.stopPropagation()},i=function(t){e._curpos.x=t.clientX,e._curpos.y=t.clientY};let s=null;const a={contextmenu:function(e){l(e)},mousemove:function(t){i(t),e.sm.fireEvent("mousemove")},mousedown:function(t){if(null===s&&(0==t.button||2==t.button)){switch(s=0==t.button?t.ctrlKey?1:0:2,s){case 0:i(t),e.sm.fireEvent("mousedown");break;case 1:case 2:i(t),e.sm.fireEvent("alt_mousedown")}l(t)}},mouseup:function(t){if(null!==s&&(t.button==s||0==t.button||1==s)){switch(t.button){case 0:i(t),e.sm.fireEvent(1==s?"alt_mouseup":"mouseup");break;case 2:i(t),e.sm.fireEvent("alt_mouseup")}s=null,l(t)}},keydown:function(t){if(t.isTrusted){switch(t.keyCode){case 13:e.sm.fireEvent("req_download");break;case 27:e.sm.fireEvent("req_exit");break;default:return}l(t)}},resize:function(){let t=null;const o=function(){t=null,e.updateVisibleElements()};return function(){null!==t&&clearTimeout(t),t=setTimeout(o,100)}}(),scroll:function(){let t=null;const o=function(){t=null,e.updateVisibleElements()};return function(){null!==t&&clearTimeout(t),t=setTimeout(o,100)}}()};document.addEventListener("contextmenu",a.contextmenu),document.addEventListener("scroll",a.scroll),window.addEventListener("resize",a.resize),document.addEventListener("keydown",a.keydown,!0),document.body.addEventListener("mousedown",a.mousedown,!0),document.body.addEventListener("mouseup",a.mouseup,!0),t.appendChild(n),t.appendChild(o);const r=new Et;r.states.load={__enter__:function(){document.documentElement.classList.add(Vt.loading),document.body.appendChild(t),t.addEventListener("webkitTransitionEnd",(function o(){t.removeEventListener("webkitTransitionEnd",o),e.sm.fireEvent("load_done")})),setTimeout((function(){e.populate(),e.updateVisibleElements(),document.documentElement.classList.remove(Vt.loading)}),0)},load_done:"idle"},r.states.exit={__enter__:function(){e._cursel&&m(),document.removeEventListener("mousemove",a.mousemove),document.removeEventListener("scroll",a.scroll),window.removeEventListener("resize",a.resize),document.removeEventListener("contextmenu",a.contextmenu),document.removeEventListener("keydown",a.keydown,!0),document.body.removeEventListener("mousedown",a.mousedown,!0),document.body.removeEventListener("mouseup",a.mouseup,!0),e._selectableElements.forEach((function(e){e._private.delegate.classList.remove(Vt.selected),e._private.delegate.classList.remove(Vt.relative),delete e._private}));const o=()=>{t.removeEventListener("webkitTransitionEnd",o),document.body.removeChild(t),document.documentElement.classList.remove(Vt.exiting),e.sm.fireEvent("exit_done")};t.addEventListener("webkitTransitionEnd",o),document.documentElement.classList.add(Vt.exiting)},__exit__:function(){Lt.instance=null},exit_done:null},r.states.idle={mousedown:"selection",alt_mousedown:"deselection",req_exit:"exit",req_download:"action-download"};let c=null,d=null;const u=function(){const t=document.createElement("div");t.classList.add(Vt.selectionRectangle),t.style.left=e._curpos.x+"px",t.style.top=e._curpos.y+"px",e._invertedSelection&&t.classList.add(Vt.inverted),e._cursel=document.body.appendChild(t),e._startpos={x:e._curpos.x,y:e._curpos.y},e._selrect={x:e._curpos.x,y:e._curpos.y,w:0,h:0},e._lastDrawn={},c=setInterval(e.drawSelection.bind(e),30),d=setInterval(e.calcSelectedElements.bind(e),30),document.addEventListener("mousemove",a.mousemove)},m=function(){document.removeEventListener("mousemove",a.mousemove),clearInterval(c),clearInterval(d),c=null,d=null,e.calcSelectedElements();for(const t in e._selectableElements){const o=e._selectableElements[t]._private;o.selected=o.selected2}return e._cursel.addEventListener("webkitTransitionEnd",function(){document.body.removeChild(this)}.bind(e._cursel)),e._cursel.classList.add(Vt.closing),delete e._cursel,delete e._startpos,delete e._selrect,delete e._lastDrawn,"idle"},_=function(){if(!e._startpos)return;const t=e._startpos,o=e._curpos,n=e._selrect;n.x=Math.min(t.x,o.x),n.y=Math.min(t.y,o.y),n.w=Math.abs(t.x-o.x),n.h=Math.abs(t.y-o.y)};r.states.selection={__enter__:function(){e._invertedSelection=!1,u()},mousemove:_,mouseup:m,req_exit:"exit"},r.states.deselection={__enter__:function(){e._invertedSelection=!0,u()},mousemove:_,alt_mouseup:m,req_exit:"exit"},r.states["action-download"]={__enter__:function(){const t=function(e){const t={};return e.forEach((function(e){if(e._private.selected){const o=function(e){let t=e.href;do{const o=e.getAttribute("thunderhref");if(o){t=o;break}if(null===e.getAttribute("thundertype"))break;const n=e.attributes.length;if(n<=0)break;for(let l=0;l<n;l++){const o=e.attributes[l].value;if(o&&0===o.toLowerCase().indexOf("thunder://")){t=o;break}}}while(0);return t}(e);t[o]=null}})),Object.keys(t)}(e._selectableElements);chrome.runtime.sendMessage({name:"xl_download_multi",referurl:document.location.href,cookie:document.cookie,urls:t}),e.sm.fireEvent("done")},done:"exit"},this.sm=r}function St(e,t){for(const o in e)e[o].classList.add(Vt.selected);for(const o in t)t[o].classList.remove(Vt.selected)}function Ut(e,t){return!(e.bottom<t.y||t.y+t.h<e.top||e.right<t.x||t.x+t.w<e.left)}Ct.prototype.populate=function(){const e=document.links,t=/^javascript:/;for(let o=0;o<e.length;o++){const n=e[o];if(null==n.href||t.test(n.href))continue;let l=n;const i=n.getElementsByTagName("img");i.length&&(l=i[0]),n._private={selected:!1,selected2:!1,delegate:l,positionfix:!1},this._selectableElements.push(n)}},Ct.prototype.updateVisibleElements=function(){const e={x:0,y:0,w:window.innerWidth,h:window.innerHeight},t=this._visibleElements,o=this._selectableElements;t.splice(0);for(const n in o){const l=o[n],i=l._private,s=i.delegate;Ut(s.getBoundingClientRect(),e)&&(t.push(l),i.positionfix||(i.positionfix=!0,"static"==window.getComputedStyle(s).position&&s.classList.add(Vt.relative)))}},Ct.prototype.drawSelection=function(){const e=this._selrect,t=this._lastDrawn,o=this._cursel.style;e.x==t.x&&e.y==t.y&&e.w==t.w&&e.h==t.h||(o.left=(t.x=e.x)+"px",o.top=(t.y=e.y)+"px",o.width=(t.w=e.w)+"px",o.height=(t.h=e.h)+"px")},Ct.prototype.calcSelectedElements=function(){const e=this._visibleElements,t=this._selrect,o=[],n=[];for(const l in e){const i=e[l]._private,s=i.delegate,a=i.delegate.getClientRects();let r=!1;for(let e=0;e<a.length;e++){if(Ut(a[e],t)){r=!0;break}}const c=r?!this._invertedSelection:i.selected;c!=i.selected2&&((c?o:n).push(s),i.selected2=c)}(o||n)&&setTimeout(St,0,o,n)},Lt={instance:null,enter:function(){null===Lt.instance&&(Lt.instance=new Ct,Lt.instance.sm.start("load"),chrome.runtime.sendMessage({name:"xl_download_multi_start",referurl:document.location.href}))},quit:function(){Lt.instance&&Lt.instance.sm.fireEvent("req_exit")},download:function(){Lt.instance&&Lt.instance.sm.fireEvent("req_download")}};const $t=Lt,Tt=Q({__name:"content-win",setup(i){const s="xl_chrome_ext_"+J;e(null),e(null),e(null);const r=e({}),c=e(!1),u=e("v2"),_=e(""),v=e({}),p=e(!1),x=e(!1),f=e(!1),g=e(!1),y=e(!1),b=e("");e(null);const L=e(!1),M=e(!1),V=e(!1),S=e(!1),U=e(!1),T=e(""),j=e(""),q=e(""),z=e(!1),G=e(""),H=e(!1),K=e({}),X=e(!1),Q=e(null),Z=w({isM3U8Video:!1,M3U8VideoUrl:""}),de=w({downloadList:[],playList:{M3U8List:[],normalVideoList:[],length:0},saveList:[],length:0});let ue,me,ve,pe,xe,fe,we=!1,ge=!1,ye=!1,be=!1,ke=!1,Ee=!0,Le=!0,Me=!1,Ve=null,Ce=[],Se=new Set,Ue=null,$e=null;function Te(e){L.value=!1,_e({action:e,source:j.value,stat:"xl_action_error"})}function je(e){Te(e)}function qe(e){U.value=!1,_e({action:e})}function Be(e){qe(e)}function Ie(e){z.value=!1,_e({action:e,stat:"xl_reminder_install"})}function Ae(e){Ie(e)}function Ne(){z.value=!0,chrome.runtime.sendMessage({name:"xl_prompt_show"})}function Oe(e){U.value=!0,q.value=e}function Re(){M.value=!1,nt(),x.value=!0,chrome.runtime.sendMessage({name:"xl_screen",type:"close",stat:"browser_plugin_close_click"})}function De(e,t){return 0!=e.length&&(0!=be&&(0!=function(e){if(0==e.length)return!1;const t=e,o=t.indexOf(":");if(-1==o)return!1;const n=t.substr(0,o+1).toUpperCase();if(""==n)return!1;let l=!0;return-1!=D.indexOf(n)?0==we&&(l=!1):-1!=P.indexOf(n)?0==ge&&(l=!1):-1!=F.indexOf(n)?0==ye&&(l=!1):l=!1,l}(e)&&(0!=function(e){if(0==e.length)return!0;const t=[],o=pe.split("||");for(const i in o){const e=o[i].slice(2).trimRight("|");t.push(e)}let n=!0;const l=e;for(const i in t)if(t[i].length>0&&-1!=l.indexOf(t[i])){n=!1;break}return n}(t)&&(!re(t,xe)&&0!=function(e){if(0==e.length)return!1;const t=e.indexOf(":");if(-1==t)return!1;const o=e.toLowerCase();if("xlapp://"==o.substr(0,t+3).trimLeft(" "))return!0;if(-1!=o.indexOf("ed2k://")||-1!=o.indexOf("magnet:?"))return!0;let n=!1,l=ce(o);return l.length>0&&(l+=";",-1!=fe.indexOf(l)&&(n=!0)),n}(e)))))}function Pe(e){return t=e,document.cookie,o=document.location.href,!ae(t)&&De(t,o);var t,o}function Fe(e){chrome.runtime.sendMessage({name:"CheckVideoInWhiteList",url:e},(async function(e){var t,o;H.value=e.exception,Me=e.videoInWhiteList,ue=e.bPlugin,Ee=e.bMonitorVideo,me=e.bWebsite,Ue=e.fluentPlayConfig,S.value=!!(null==(t=null==e?void 0:e.fluentPlayConfig)?void 0:t.switch),$e=e.downloadSniffConfig,V.value=!!(null==(o=null==e?void 0:e.downloadSniffConfig)?void 0:o.switch),Me&&Ee&&me&&(rt(),chrome.runtime.sendMessage({name:"xl_screen",type:"init",data:{params:{playForm:document.referrer}}},e=>{Z.isM3U8Video=e.isM3U8Video,Z.M3U8VideoUrl=e.M3U8VideoUrl}),(Ue.switch||$e.switch)&&ct(),!ue&&f.value&&await I()&&chrome.runtime.sendMessage({name:"xl_show_notifications"}))}))}function ze(e){var t;if(e.ctrlKey)return;if(!e.isTrusted)return;const o=(null==(t=null==e?void 0:e.target)?void 0:t.href)||"";if(ue&&me&&ve){let t=se(o);if(null!=t)return;if(t=Pe(o),t)return chrome.runtime.sendMessage({name:"xl_download",link:o,cookie:document.cookie,referurl:document.location.href}),e.stopPropagation(),void e.preventDefault()}else H.value&&((n=(n=o).toLowerCase()).startsWith("thunder://")||n.startsWith("ed2k://")||n.startsWith("magnet:?")||n.includes(".torrent"))&&chrome.runtime.sendMessage({name:"xl_prompt_enable"},(function(e){e&&e.enable&&Ne()}));var n}function We(){ot.info("RegisterClickEventListener",f.value,document.links);const e=e=>{ze(e)};if(f.value)for(const t of document.links)t.addEventListener("click",e,!1);else for(const t of document.links)t.outerHTML.match(A),t.addEventListener("click",e,!1)}function Je(){document.getElementById(s);M.value=!1}async function Ge(e){do{if(x.value)break;const{M3U8VideoUrl:t}=Z,o=document.getElementById(s),n=B(t||G.value);o.style.display="block";const l=o.querySelector(".xl-chrome-ext-tips.cloud-add"),i=o.querySelector(".xl-chrome-ext-tips.download"),a=N(Ue,n.suffix,n.protocol),r=N($e,n.suffix,n.protocol);l&&!a&&(S.value=!1),i&&!r&&(V.value=!1);const c=e.getBoundingClientRect();let d="position: fixed !important; z-index: 10000000000 !important;";d+=`left: ${c.x+4}px; top: ${c.y+4}px;`,y.value&&(b.value=`top:${c.y+16}px`),o.style=d,ke||(ke=!0,chrome.runtime.sendMessage({name:"VideoShow",referurl:document.location.href,hasDownload:r,videoSrc:e.src},(function(){}))),M.value=!0,O(o)}while(0)}function He(e){e.isTrusted&&(e.ctrlKey&&chrome.runtime.sendMessage({name:"EnabledCapture",capture:!1},(function(){})),window.top!==window.self&&chrome.runtime.sendMessage({name:"xl_chrome_iframe_keydown",keyCode:e.keyCode}))}function Ke(e){if(e.isTrusted&&(e.ctrlKey&&chrome.runtime.sendMessage({name:"EnabledCapture",capture:!0},(function(){})),Le))switch(e.keyCode){case 68:e.shiftKey&&(oe()||ue&&(window.top===window.self?$t.enter():chrome.runtime.sendMessage({name:"xl_chrome_iframe_multi_hotkey"})))}}function Ye(e){var t,o;try{const n=document.elementFromPoint(e.x,e.y);do{if(!n)break;if(null==(t=null==n?void 0:n.tagName)||t.toUpperCase(),"VIDEO"===(null==(o=null==n?void 0:n.tagName)?void 0:o.toUpperCase())){const{isM3U8Video:e}=Z,t=n.src||ne(n,e);if(!t)break;if(0===(null==t?void 0:t.toLowerCase().indexOf("blob:"))&&!e)break;if(n===K.value)break;K.value=n,G.value=t||"",Ge(n);break}if(K.value){if(!le(e,K.value)){K.value="",G.value="",Je();break}}else{const t=document.getElementsByTagName("video");if(Ce=t,0===Ce.length)break;let o=null;for(let n=0;n<Ce.length;n++){const t=Ce[n];if("none"!==window.getComputedStyle(t).display)if(le(e,t))if(o){const e=Number(window.getComputedStyle(t).zIndex)||0;e>(Number(window.getComputedStyle(o).zIndex)||0)&&(o=t)}else o=t;else if(o)break}if(o){const e=o.src||ne(o),{isM3U8Video:t}=Z;(e&&0!==e.toLowerCase().indexOf("blob:")||t)&&(K.value=o,G.value=e,Ge(o));break}}}while(0)}catch(n){}}function Qe(e){const t=document.getElementById(W).contains(e.toElement);K.value&&(t||(K.value="",G.value="",Je()))}function Ze(e){Ye(e)}function et(){K.value&&Ge(K.value)}function nt(){document.body.removeEventListener("mousemove",Ye,!0),window.self!==window.top&&document.body.removeEventListener("mouseout",Qe),document.body.removeEventListener("wheel",Ze),document.removeEventListener("scroll",et),K.value="",G.value="",Ce=[],Ve&&(Ve.disconnect(),Ve=null)}function it(){return window.top===window.self}function st(e){if("data"===e.data.type&&it())try{const t=JSON.parse(e.data.payload);Object.assign(de,{...t}),c.value=!0}catch(t){}}function at(e,t){chrome.runtime.sendMessage({name:"xl_show_action_error_dialog",source:t}),L.value=!0,T.value=e,j.value=t}function rt(){Ee&&Me&&!x.value&&(nt(),async function(){do{if(Ve)break;let t=null;try{t=window.top.document.getElementsByTagName("title")[0]}catch(e){}t&&(Ve=new MutationObserver((function(){const e=document.getElementsByTagName("video");Ce=e})),Ve.observe(t,{childList:!0})),Ce=await R(),C(Ce)}while(0)}(),document.body.addEventListener("mousemove",Ye,!0),window.self!==window.top&&document.body.addEventListener("mouseout",Qe),document.body.addEventListener("wheel",Ze),document.addEventListener("scroll",et))}d(f,()=>{We()}),d(p,e=>{e&&chrome.runtime.sendMessage({name:"xl_stat",eventId:974,extParam:{tabUrl:window.location.href}})});const ct=async()=>{Se=ie();0!==(await async function(){return new Promise(e=>{for(const t of Se){const o=B(t),{suffix:n,isVideoURL:l,protocol:i}=o,s=N(Ue,n,i),a=N($e,n,i);let r=!1;if(("unknown"!==n||i)&&(a&&(de.downloadList.push(o),r=!0),s&&(l&&(de.playList[".m3u8"===n?"M3U8List":"normalVideoList"].push(o),de.playList.length+=1),de.saveList.push(o),r=!0),r&&(de.length+=1),99===de.length))return void e(de)}setTimeout(()=>{const{M3U8VideoUrl:t}=Z;if(t){if(de.downloadList.some(e=>e.url===t))return void e(de);const o=B(t);if(!N(Ue,o.suffix,o.protocol)||!N($e,o.suffix,o.protocol))return;de.downloadList.unshift(o),de.playList.M3U8List.unshift(o),de.saveList.unshift(o),de.playList.length+=1,de.length+=1}e(de)},1500)})}()).length&&(it()?c.value=!0:window.parent.postMessage({type:"data",payload:JSON.stringify(de)},"*"))};function dt(){c.value=!1}const mt=async()=>{var e;X.value=!0,e=document.location.href,chrome.runtime.sendMessage({name:"CheckActivated",url:e}),We(),Fe(document.location.href),document.addEventListener("keydown",He),document.addEventListener("keyup",Ke,!0),window.addEventListener("message",st),async function(){var e;try{const t=await ee({name:"GetConfig"});if(!t)return void(r.value={});r.value=t,we=t.bMonitorEmule,ge=t.bMonitorMagnet,ye=t.bMonitorTradition,be=t.bMonitorIE,pe=t.monitorDomains,xe=t.filterDomains,fe=t.monitorFileExts,g.value=te(window.location.href,t.jsqConfig),v.value=(null==(e=null==t?void 0:t.jsqConfig)?void 0:e.text)||{},p.value=t.isStatGlobal,u.value=(null==t?void 0:t.videoTagVersion)||Y}catch(t){r.value={}}}()};return chrome.runtime.onMessage.addListener((function(e,t,o){if("UpdatePluginEnabled"==e.name)H.value=e.exception,ue=e.enable,ue||$t.quit();else if("UpdateMoniterVideoTags"==e.name)Ee=e.enable;else if("UpdateMultiSelectShortcutEnable"==e.name)Le=e.enable;else if("UpdateWebsiteEnabled"==e.name)me=e.enable;else if("UpdatePageEnabled"==e.name)ve=e.enable;else if("OnActivated"==e.name)X.value&&async function(e,t,o){try{const n=await chrome.runtime.sendMessage({name:"CheckEnabled",url:e,tabId:t,topFrame:o});if(ue=n.bPlugin,Ee=n.bMonitorVideo,me=n.bWebsite,ve=n.bPage,Le=n.bShortcutEnable,f.value=n.isShowRecallInfo,!Ee||!me)return void nt();rt()}catch(n){}}(document.location.href,e.tabId,window.top===window.self);else if("UpdateMonitorDomains"==e.name)pe=e.monitorDomains;else{if("GetCookie"==e.name)return o({cookie:document.cookie}),!0;if("ThunderSupportReminder"===e.name)window.self===window.top&&Ne(e.text);else if("EnterMultiSelect"===e.name){if($())return;$t.enter()}else if("xl_chrome_iframe_keydown"===e.name){if(window.top===window.self)switch(e.keyCode){case 13:$t.download();break;case 27:$t.quit()}}else if("xl_chrome_iframe_multi_hotkey"===e.name)window.top===window.self&&$t.enter();else if("GetAllImages"===e.name){if(window.top===window.self){const e=[];for(const t of document.images)t.src&&e.push({src:t.src,width:t.width,height:t.height,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight});return o(e),!0}}else"xl_recall_entry_click"===e.name||"appendFooterUI"===e.name&&(c.value=!0)}})),t(async()=>{mt()}),h(()=>{window.removeEventListener("message",st),document.removeEventListener("keydown",He),document.removeEventListener("keyup",Ke,!0),document.body.removeEventListener("mousemove",Ye,!0),it()||document.body.removeEventListener("mouseout",Qe),document.body.removeEventListener("wheel",Ze),document.removeEventListener("scroll",et)}),(e,t)=>{var i;return o(),n("div",{class:l(e.$style.content_wrapper),ref_key:"panelRef",ref:Q},[m(kt,{config:r.value,uiVersion:(null==(i=r.value)?void 0:i.videoTagVersion)||"v2",exception:H.value,latestVideoSrc:G.value,isShowVideoTag:M.value,isShowDownloadBar:V.value,isShowCloudAddBar:S.value,latestVideoElement:K.value,onShowActionError:at,onShowVersionError:Oe,onHandleCloseBar:Re},null,8,["config","uiVersion","exception","latestVideoSrc","isShowVideoTag","isShowDownloadBar","isShowCloudAddBar","latestVideoElement"]),m(lt),z.value?(o(),k(E(tt),{key:0,onSubmit:Ae,onCancel:Ie})):a("",!0),L.value?(o(),k(E(he),{key:1,text:T.value,onSubmit:je,onCancel:Te},null,8,["text"])):a("",!0),U.value?(o(),k(E(ut),{key:2,text:q.value,onSubmit:Be,onCancel:qe},null,8,["text"])):a("",!0),c.value?(o(),k(E(Xe),{key:3,tabUrl:_.value,isShowJsqEntry:g.value,jsqText:v.value,onRemoveFooter:dt,resourceList:de,exception:H.value},null,8,["tabUrl","isShowJsqEntry","jsqText","resourceList","exception"])):a("",!0)],2)}}},[["__cssModules",{$style:{"content-wrapper":"_content-wrapper_20md8_1","xl-chrome-ext-bar-toast":"_xl-chrome-ext-bar-toast_20md8_1","options-wrapper":"_options-wrapper_20md8_7"}}]]),jt="xl_chrome_ext_"+J;let qt=!1;function Bt(){if(document.getElementById(jt))return;document.body.parentNode;const e=document.createElement("div");e.className="xl-chrome-ext-bar_"+J,e.style.display="block",e.id=jt,document.documentElement.appendChild(e)}try{Bt(),It(),qt=!0}catch(At){qt=!1}function It(){z?L(me).mount("#"+jt):L(Tt).mount("#"+jt)}window.addEventListener("load",()=>{setTimeout(()=>{qt||(Bt(),It(),qt=!0)},0)});
